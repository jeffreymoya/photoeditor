schema_version: "1.0"
id: TASK-0813
title: "Document purity & immutability heuristics"
status: completed
priority: P1
area: docs

description: >-
  Capture concrete heuristics for pure functions and immutability that align with the
  project's TypeScript, neverthrow, Redux Toolkit, RTK Query, and OneTable usage so reviewers
  can evaluate future changes consistently. The current standards mention targets but lack
  operational guidance tied to the tech stack.

outcome: >-
  Standards in `standards/` clearly describe how to keep domain logic pure, how to structure
  immutable data flows across backend and mobile tiers, and what evidence reviewers should expect
  when assessing purity/immutability.

scope:
  in:
    - standards/typescript.md
    - standards/backend-tier.md
    - standards/frontend-tier.md
    - standards/cross-cutting.md
  out:
    - Code refactors to enforce the new guidance
    - Changes to automation tooling or lint rules beyond documentation updates

context:
  standards_tier: ops
  issues: []
  related_docs:
    - standards/AGENTS.md
    - standards/testing-standards.md
  repo_paths:
    - standards/typescript.md
    - standards/backend-tier.md
    - standards/frontend-tier.md
    - standards/cross-cutting.md
  dependencies: []

environment:
  os: ubuntu-22.04
  runtimes:
    node: "18.x"
  tools:
    - name: pnpm
      version: ">=8 <9"

constraints:
  approvals_required: false
  sandbox:
    filesystem: workspace-write
    network: enabled
  coding_guidelines:
    - Keep diffs minimal and focused
    - Respect repository conventions
  prohibited:
    - No secrets or tokens in code
    - No unrelated file changes

plan:
  - id: 1
    title: Audit current standards language
    details: >-
      Review the referenced standards to catalogue existing purity and immutability guidance, mapping each clause to affected tiers per
      standards/typescript.md#3-analyzability, standards/backend-tier.md#domain-service-layer, standards/frontend-tier.md#state--logic-layer, and standards/cross-cutting.md#maintainability--change-impact.
    actor: agent
    inputs:
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
      - standards/cross-cutting.md
    outputs:
      - docs/evidence/purity-immutability-gap-notes.md
    definition_of_done:
      - docs/evidence/purity-immutability-gap-notes.md lists current guidance with citations to standards/typescript.md#3-analyzability, standards/backend-tier.md#domain-service-layer, standards/frontend-tier.md#state--logic-layer, and standards/cross-cutting.md#maintainability--change-impact, highlighting gaps.
    estimate: S
    expected_files_touched:
      - docs/evidence/purity-immutability-gap-notes.md
  - id: 2
    title: Draft heuristics per tier
    details: >-
      Add concrete guidance tying purity/immutability expectations to stack usage (neverthrow, OneTable, RTK Query) inside relevant standards sections, aligning with standards/standards-governance-ssot.md#standards-grounding--change-requests-ssot for documentation changes.
    actor: agent
    inputs:
      - docs/evidence/purity-immutability-gap-notes.md
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
    outputs:
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
    definition_of_done:
      - Updated sections explicitly state heuristics with inline references back to docs/evidence/purity-immutability-gap-notes.md and cite standards/standards-governance-ssot.md#standards-grounding--change-requests-ssot where exceptions apply.
    estimate: M
    expected_files_touched:
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
  - id: 3
    title: Define evidence expectations
    details: >-
      Update standards/cross-cutting.md with reviewer artefact expectations for purity/immutability, grounding language in standards/testing-standards.md#evidence-expectations.
    actor: agent
    inputs:
      - docs/evidence/purity-immutability-gap-notes.md
      - standards/testing-standards.md
    outputs:
      - standards/cross-cutting.md
      - docs/evidence/purity-immutability-gap-notes.md
    definition_of_done:
      - standards/cross-cutting.md gains an evidence subsection referencing standards/testing-standards.md#evidence-expectations, with docs/evidence/purity-immutability-gap-notes.md updated to link the new clause.
    estimate: S
    expected_files_touched:
      - standards/cross-cutting.md
      - docs/evidence/purity-immutability-gap-notes.md
  - id: 4
    title: Self-review and align references
    details: >-
      Cross-read updated standards to ensure terminology consistency and backlinks align with standards/standards-governance-ssot.md#standards-grounding--change-requests-ssot.
    actor: agent
    inputs:
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
      - standards/cross-cutting.md
      - docs/evidence/purity-immutability-gap-notes.md
    outputs:
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
      - standards/cross-cutting.md
      - docs/evidence/purity-immutability-gap-notes.md
    definition_of_done:
      - Updated files include cross-links referencing each other and standards/standards-governance-ssot.md#standards-grounding--change-requests-ssot, and docs/evidence/purity-immutability-gap-notes.md records review results.
    estimate: S
    expected_files_touched:
      - standards/typescript.md
      - standards/backend-tier.md
      - standards/frontend-tier.md
      - standards/cross-cutting.md
      - docs/evidence/purity-immutability-gap-notes.md

acceptance_criteria:
  - TypeScript standards define what constitutes a pure function and immutable structure with examples tied to neverthrow, Zod mappers, and DTO usage.
  - Backend and frontend tier standards describe how services/hooks should remain pure and immutable when using OneTable, Redux Toolkit, RTK Query, and XState.
  - Cross-cutting standards list the artefacts reviewers should request to validate purity/immutability claims.
  - No lint errors; `pnpm turbo run qa:static --parallel` completes successfully.

validation:
  manual_checks:
    - Verify new guidance cross-links relevant standards sections without conflicting terminology.
  artifacts:
    - screenshots: []

deliverables:
  - standards/typescript.md
  - standards/backend-tier.md
  - standards/frontend-tier.md
  - standards/cross-cutting.md

risks:
  - description: Guidance could conflict with existing enforcement automation or reviewer workflow.
    mitigation: Cross-reference existing standards and call out when additional automation is future work.
