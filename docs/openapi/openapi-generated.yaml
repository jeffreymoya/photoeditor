openapi: 3.0.3
info:
  title: Photo Editor API
  version: 1.0.0
  description: API contracts generated from Zod schemas for the Photo Editor application
  license:
    name: MIT
  contact:
    name: API Support
servers:
  - url: http://localhost:4566
    description: LocalStack development server
  - url: https://api.photoeditor.dev
    description: Development environment
  - url: https://api.photoeditor.com
    description: Production environment
paths:
  /v1/upload/presign:
    post:
      operationId: presignUpload
      summary: Generate presigned upload URL
      description: >-
        Creates a presigned S3 upload URL and job record for single or batch photo uploads. Supports both single file
        and batch uploads based on request body structure.
      tags:
        - Upload
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                anyOf:
                  - type: object
                    properties:
                      jobId:
                        type: string
                        format: uuid
                      presignedUrl:
                        type: string
                        format: uri
                      s3Key:
                        type: string
                      expiresAt:
                        type: string
                        format: date-time
                    required:
                      - jobId
                      - presignedUrl
                      - s3Key
                      - expiresAt
                    additionalProperties: false
                  - type: object
                    properties:
                      batchJobId:
                        type: string
                        format: uuid
                      uploads:
                        type: array
                        items:
                          type: object
                          properties:
                            presignedUrl:
                              type: string
                              format: uri
                            s3Key:
                              type: string
                            expiresAt:
                              type: string
                              format: date-time
                          required:
                            - presignedUrl
                            - s3Key
                            - expiresAt
                          additionalProperties: false
                      childJobIds:
                        type: array
                        items:
                          type: string
                          format: uuid
                    required:
                      - batchJobId
                      - uploads
                      - childJobIds
                    additionalProperties: false
        '400':
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '404':
          description: Not Found - Resource does not exist
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              anyOf:
                - type: object
                  properties:
                    fileName:
                      type: string
                      minLength: 1
                    contentType:
                      type: string
                      pattern: ^image\/(jpeg|png|heic|webp)$
                    fileSize:
                      type: number
                      exclusiveMinimum: true
                      minimum: 0
                      maximum: 52428800
                    prompt:
                      type: string
                      minLength: 1
                  required:
                    - fileName
                    - contentType
                    - fileSize
                  additionalProperties: false
                - type: object
                  properties:
                    files:
                      type: array
                      items:
                        type: object
                        properties:
                          fileName:
                            type: string
                            minLength: 1
                          contentType:
                            type: string
                            pattern: ^image\/(jpeg|png|heic|webp)$
                          fileSize:
                            type: number
                            exclusiveMinimum: true
                            minimum: 0
                            maximum: 52428800
                        required:
                          - fileName
                          - contentType
                          - fileSize
                        additionalProperties: false
                      minItems: 1
                      maxItems: 10
                    sharedPrompt:
                      type: string
                      minLength: 1
                    individualPrompts:
                      type: array
                      items:
                        anyOf:
                          - not: {}
                          - type: string
                  required:
                    - files
                    - sharedPrompt
                  additionalProperties: false
  /v1/jobs/{id}:
    get:
      operationId: getJobStatus
      summary: Get job status
      description: Retrieves the current processing status and metadata for a job by its ID.
      tags:
        - Jobs
      parameters:
        - name: id
          in: path
          description: Job UUID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum:
                      - QUEUED
                      - PROCESSING
                      - EDITING
                      - COMPLETED
                      - FAILED
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
                  error:
                    type: string
                required:
                  - jobId
                  - status
                  - createdAt
                  - updatedAt
                additionalProperties: false
        '400':
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '404':
          description: Not Found - Resource does not exist
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
  /v1/batch-status/{batchJobId}:
    get:
      operationId: getBatchJobStatus
      summary: Get batch job status
      description: Retrieves aggregate status and progress for a batch job, including completion count and child job IDs.
      tags:
        - Jobs
        - Batch
      parameters:
        - name: batchJobId
          in: path
          description: Batch Job UUID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  batchJobId:
                    type: string
                    format: uuid
                  userId:
                    type: string
                  status:
                    type: string
                    enum:
                      - QUEUED
                      - PROCESSING
                      - EDITING
                      - COMPLETED
                      - FAILED
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
                  sharedPrompt:
                    type: string
                  completedCount:
                    type: number
                    minimum: 0
                  totalCount:
                    type: number
                    exclusiveMinimum: true
                    minimum: 0
                  childJobIds:
                    type: array
                    items:
                      type: string
                      format: uuid
                  error:
                    type: string
                required:
                  - batchJobId
                  - userId
                  - status
                  - createdAt
                  - updatedAt
                  - sharedPrompt
                  - completedCount
                  - totalCount
                  - childJobIds
                additionalProperties: false
        '400':
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '404':
          description: Not Found - Resource does not exist
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
  /v1/jobs/{id}/download:
    get:
      operationId: downloadJobResult
      summary: Get download URL for completed job
      description: Generates a presigned S3 download URL for a completed job's edited photo. Returns 400 if job is not completed.
      tags:
        - Jobs
        - Download
      parameters:
        - name: id
          in: path
          description: Job UUID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  downloadUrl:
                    type: string
                    format: uri
                  expiresAt:
                    type: string
                    format: date-time
                  jobId:
                    type: string
                    format: uuid
                  status:
                    type: string
                required:
                  - downloadUrl
                  - expiresAt
                  - jobId
                  - status
                additionalProperties: false
        '400':
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '404':
          description: Not Found - Resource does not exist
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
  /v1/device-tokens:
    post:
      operationId: registerDeviceToken
      summary: Register device token
      description: Registers an Expo push notification token for a user's device to enable push notifications for job completion.
      tags:
        - Notifications
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                required:
                  - success
                  - message
                additionalProperties: false
        '400':
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '404':
          description: Not Found - Resource does not exist
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expoPushToken:
                  type: string
                  minLength: 1
                platform:
                  type: string
                  enum:
                    - ios
                    - android
                deviceId:
                  type: string
                  minLength: 1
              required:
                - expoPushToken
                - platform
                - deviceId
              additionalProperties: false
    delete:
      operationId: deactivateDeviceToken
      summary: Deactivate device token
      description: Deactivates a previously registered push notification token, stopping notifications for the specified device.
      tags:
        - Notifications
      parameters:
        - name: deviceId
          in: query
          description: Device identifier to deactivate
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                required:
                  - success
                  - message
                additionalProperties: false
        '400':
          description: Bad Request - Invalid input or validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '404':
          description: Not Found - Resource does not exist
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                      message:
                        type: string
                      details:
                        type: object
                        additionalProperties: {}
                    required:
                      - code
                      - message
                    additionalProperties: false
                  timestamp:
                    type: string
                    format: date-time
                  requestId:
                    type: string
                required:
                  - error
                  - timestamp
                  - requestId
                additionalProperties: false
components:
  schemas:
    FileUpload:
      type: object
      properties:
        fileName:
          type: string
          minLength: 1
        contentType:
          type: string
          pattern: ^image\/(jpeg|png|heic|webp)$
        fileSize:
          type: number
          exclusiveMinimum: true
          minimum: 0
          maximum: 52428800
      required:
        - fileName
        - contentType
        - fileSize
      additionalProperties: false
    PresignUploadRequest:
      type: object
      properties:
        fileName:
          type: string
          minLength: 1
        contentType:
          type: string
          pattern: ^image\/(jpeg|png|heic|webp)$
        fileSize:
          type: number
          exclusiveMinimum: true
          minimum: 0
          maximum: 52428800
        prompt:
          type: string
          minLength: 1
      required:
        - fileName
        - contentType
        - fileSize
      additionalProperties: false
    PresignUploadResponse:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        presignedUrl:
          type: string
          format: uri
        s3Key:
          type: string
        expiresAt:
          type: string
          format: date-time
      required:
        - jobId
        - presignedUrl
        - s3Key
        - expiresAt
      additionalProperties: false
    BatchUploadRequest:
      type: object
      properties:
        files:
          type: array
          items:
            type: object
            properties:
              fileName:
                type: string
                minLength: 1
              contentType:
                type: string
                pattern: ^image\/(jpeg|png|heic|webp)$
              fileSize:
                type: number
                exclusiveMinimum: true
                minimum: 0
                maximum: 52428800
            required:
              - fileName
              - contentType
              - fileSize
            additionalProperties: false
          minItems: 1
          maxItems: 10
        sharedPrompt:
          type: string
          minLength: 1
        individualPrompts:
          type: array
          items:
            anyOf:
              - not: {}
              - type: string
      required:
        - files
        - sharedPrompt
      additionalProperties: false
    BatchUploadResponse:
      type: object
      properties:
        batchJobId:
          type: string
          format: uuid
        uploads:
          type: array
          items:
            type: object
            properties:
              presignedUrl:
                type: string
                format: uri
              s3Key:
                type: string
              expiresAt:
                type: string
                format: date-time
            required:
              - presignedUrl
              - s3Key
              - expiresAt
            additionalProperties: false
        childJobIds:
          type: array
          items:
            type: string
            format: uuid
      required:
        - batchJobId
        - uploads
        - childJobIds
      additionalProperties: false
    JobStatusResponse:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - QUEUED
            - PROCESSING
            - EDITING
            - COMPLETED
            - FAILED
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        error:
          type: string
      required:
        - jobId
        - status
        - createdAt
        - updatedAt
      additionalProperties: false
    DeviceTokenRegistration:
      type: object
      properties:
        expoPushToken:
          type: string
          minLength: 1
        platform:
          type: string
          enum:
            - ios
            - android
        deviceId:
          type: string
          minLength: 1
      required:
        - expoPushToken
        - platform
        - deviceId
      additionalProperties: false
    DeviceTokenResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required:
        - success
        - message
      additionalProperties: false
    HealthCheckResponse:
      type: object
      properties:
        status:
          type: string
          enum:
            - healthy
        version:
          type: string
        timestamp:
          type: string
          format: date-time
      required:
        - status
        - version
        - timestamp
      additionalProperties: false
    ApiError:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
              additionalProperties: {}
          required:
            - code
            - message
          additionalProperties: false
        timestamp:
          type: string
          format: date-time
        requestId:
          type: string
      required:
        - error
        - timestamp
        - requestId
      additionalProperties: false
    Job:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        userId:
          type: string
        status:
          type: string
          enum:
            - QUEUED
            - PROCESSING
            - EDITING
            - COMPLETED
            - FAILED
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        tempS3Key:
          type: string
        finalS3Key:
          type: string
        error:
          type: string
        locale:
          type: string
          default: en
        settings:
          type: object
          additionalProperties: {}
        expires_at:
          type: number
        prompt:
          type: string
        batchJobId:
          type: string
          format: uuid
      required:
        - jobId
        - userId
        - status
        - createdAt
        - updatedAt
      additionalProperties: false
    JobStatus:
      type: string
      enum:
        - QUEUED
        - PROCESSING
        - EDITING
        - COMPLETED
        - FAILED
    CreateJobRequest:
      type: object
      properties:
        userId:
          type: string
        locale:
          type: string
          default: en
        settings:
          type: object
          additionalProperties: {}
        prompt:
          type: string
        batchJobId:
          type: string
          format: uuid
      required:
        - userId
      additionalProperties: false
    BatchJob:
      type: object
      properties:
        batchJobId:
          type: string
          format: uuid
        userId:
          type: string
        status:
          type: string
          enum:
            - QUEUED
            - PROCESSING
            - EDITING
            - COMPLETED
            - FAILED
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        sharedPrompt:
          type: string
        individualPrompts:
          type: array
          items:
            anyOf:
              - not: {}
              - type: string
        childJobIds:
          type: array
          items:
            type: string
            format: uuid
        completedCount:
          type: number
          minimum: 0
          default: 0
        totalCount:
          type: number
          exclusiveMinimum: true
          minimum: 0
        error:
          type: string
        locale:
          type: string
          default: en
        settings:
          type: object
          additionalProperties: {}
        expires_at:
          type: number
      required:
        - batchJobId
        - userId
        - status
        - createdAt
        - updatedAt
        - sharedPrompt
        - childJobIds
        - totalCount
      additionalProperties: false
    CreateBatchJobRequest:
      type: object
      properties:
        userId:
          type: string
        sharedPrompt:
          type: string
        individualPrompts:
          type: array
          items:
            anyOf:
              - not: {}
              - type: string
        fileCount:
          type: number
          exclusiveMinimum: true
          minimum: 0
        locale:
          type: string
          default: en
        settings:
          type: object
          additionalProperties: {}
      required:
        - userId
        - sharedPrompt
        - fileCount
      additionalProperties: false
    JobStatusUpdate:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        batchJobId:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - QUEUED
            - PROCESSING
            - EDITING
            - COMPLETED
            - FAILED
        progress:
          type: number
          minimum: 0
          maximum: 100
        message:
          type: string
        error:
          type: string
        finalS3Key:
          type: string
        timestamp:
          type: string
          format: date-time
      required:
        - jobId
        - status
        - timestamp
      additionalProperties: false
    GeminiAnalysisRequest:
      type: object
      properties:
        imageUrl:
          type: string
          format: uri
        prompt:
          type: string
          default: Analyze this image and provide a detailed description for photo editing purposes.
      required:
        - imageUrl
      additionalProperties: false
    GeminiAnalysisResponse:
      type: object
      properties:
        analysis:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        metadata:
          type: object
          additionalProperties: {}
      required:
        - analysis
      additionalProperties: false
    SeedreamEditingRequest:
      type: object
      properties:
        imageUrl:
          type: string
          format: uri
        analysis:
          type: string
        editingInstructions:
          type: string
      required:
        - imageUrl
        - analysis
      additionalProperties: false
    SeedreamEditingResponse:
      type: object
      properties:
        editedImageUrl:
          type: string
          format: uri
        processingTime:
          type: number
        metadata:
          type: object
          additionalProperties: {}
      required:
        - editedImageUrl
      additionalProperties: false
    ProviderConfig:
      type: object
      properties:
        name:
          type: string
        apiKey:
          type: string
        baseUrl:
          type: string
          format: uri
        timeout:
          type: number
          default: 30000
        retries:
          type: number
          default: 3
        enabled:
          type: boolean
          default: true
      required:
        - name
        - apiKey
        - baseUrl
      additionalProperties: false
    ProviderResponse:
      type: object
      properties:
        success:
          type: boolean
        data: {}
        error:
          type: string
        duration:
          type: number
        provider:
          type: string
        timestamp:
          type: string
          format: date-time
      required:
        - success
        - duration
        - provider
        - timestamp
      additionalProperties: false
