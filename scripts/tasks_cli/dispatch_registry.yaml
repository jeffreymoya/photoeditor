# Dispatch Registry for Tasks CLI Command Routing
#
# This registry maps CLI commands to their handler type:
# - 'legacy': Uses argparse-based handlers in __main__.py
# - 'typer': Uses Typer framework handlers (to be implemented in Wave 1)
#
# Wave 1 Migration Plan:
# - list, validate, explain will be first to migrate to Typer
# - Other commands will follow in subsequent waves
#
# Environment Variable Override:
# - TASKS_CLI_LEGACY_DISPATCH=1 forces all commands to use legacy handlers
#   regardless of this registry (for emergency rollback)

commands:
  # Core task queries (Wave 1 - MIGRATED)
  list:
    handler: typer
    migrated: true
    description: "List tasks with optional filtering"

  validate:
    handler: typer
    migrated: true
    description: "Validate dependency graph for cycles and missing deps"

  show:
    handler: typer
    migrated: true
    description: "Show detailed information for a specific task"

  explain:
    handler: legacy
    migrated: false
    description: "Explain dependency chain for a task"

  # Task workflow operations (Wave 2 - MIGRATED)
  pick:
    handler: typer
    migrated: true
    description: "Pick next task using priority algorithm"

  claim:
    handler: typer
    migrated: true
    description: "Claim a task (transition to in_progress)"

  complete:
    handler: typer
    migrated: true
    description: "Complete a task and archive it"

  archive:
    handler: typer
    migrated: true
    description: "Archive a completed task without status change"

  # Graph and cache operations (Wave 2 - MIGRATED)
  graph:
    handler: typer
    migrated: true
    description: "Export dependency graph in DOT format"

  refresh-cache:
    handler: typer
    migrated: true
    description: "Force rebuild of task cache"

  check-halt:
    handler: typer
    migrated: true
    description: "Check for workflow halt conditions"

  # Task validation and quality
  lint:
    handler: legacy
    migrated: false
    description: "Lint task file for schema compliance"

  bootstrap-evidence:
    handler: legacy
    migrated: false
    description: "Create evidence file stub"

  # Context cache lifecycle
  init-context:
    handler: typer
    migrated: true
    description: "Initialize task context with validations"

  get-context:
    handler: typer
    migrated: true
    description: "Read context (immutable + coordination)"

  update-agent:
    handler: typer
    migrated: true
    description: "Update coordination state for agent"

  mark-blocked:
    handler: legacy
    migrated: false
    description: "Add blocking finding to coordination"

  purge-context:
    handler: typer
    migrated: true
    description: "Manual context cleanup"

  rebuild-context:
    handler: typer
    migrated: true
    description: "Rebuild context from manifest"

  # Delta tracking
  snapshot-worktree:
    handler: typer
    migrated: true
    description: "Snapshot working tree state"

  verify-worktree:
    handler: typer
    migrated: true
    description: "Verify working tree for drift"

  get-diff:
    handler: typer
    migrated: true
    description: "Retrieve diff file path"

  record-qa:
    handler: typer
    migrated: true
    description: "Record QA command results"

  compare-qa:
    handler: typer
    migrated: true
    description: "Compare QA results against baseline"

  resolve-drift:
    handler: typer
    migrated: true
    description: "Reset drift budget and record resolution"

  # Evidence and standards
  attach-evidence:
    handler: legacy
    migrated: false
    description: "Attach evidence to task context"

  list-evidence:
    handler: legacy
    migrated: false
    description: "List evidence attachments"

  attach-standard:
    handler: legacy
    migrated: false
    description: "Attach standards excerpt to context"

  # Exception ledger
  add-exception:
    handler: legacy
    migrated: false
    description: "Add exception to ledger"

  list-exceptions:
    handler: legacy
    migrated: false
    description: "List exceptions from ledger"

  resolve-exception:
    handler: legacy
    migrated: false
    description: "Resolve exception in ledger"

  cleanup-exceptions:
    handler: legacy
    migrated: false
    description: "Cleanup exceptions based on trigger"

  # Quarantine management
  quarantine-task:
    handler: legacy
    migrated: false
    description: "Quarantine a task"

  list-quarantined:
    handler: legacy
    migrated: false
    description: "List quarantined tasks"

  release-quarantine:
    handler: legacy
    migrated: false
    description: "Release task from quarantine"

  # Validation and metrics
  run-validation:
    handler: legacy
    migrated: false
    description: "Run validation command with features"

  collect-metrics:
    handler: legacy
    migrated: false
    description: "Collect metrics for a task"

  generate-dashboard:
    handler: legacy
    migrated: false
    description: "Generate metrics dashboard"

  compare-metrics:
    handler: legacy
    migrated: false
    description: "Compare baseline and current metrics"

  # Context store management (Wave 3)
  context:
    handler: typer
    migrated: true
    description: "Context store management commands"

  context-migrate:
    handler: typer
    migrated: true
    description: "Migrate context bundles to current schema"

  context-info:
    handler: typer
    migrated: true
    description: "Show context bundle metadata"

  context-validate:
    handler: typer
    migrated: true
    description: "Validate context bundle integrity"
